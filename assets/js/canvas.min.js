function drawActivity(e,n){var t=new Path.Rectangle({rectangle:{x:e-50,y:n-25,width:100,height:50},strokeWidth:2,strokeColor:"black",fillColor:"white",type:"activity",name:"activity",userName:"",subtype:""}),o=new PointText({fontSize:18,fillColor:"black",justification:"center",name:"elementText",point:[e,n+50]}),i=makeConnectors(e,n,100,50),c=new Group({children:[t,o,i],name:"activtyGroup"}),r=new SymbolDefinition(c),l=new SymbolItem(r,[e,n]);l.onMouseEnter=function(){this.definition.item.children.connectorGroup.visible=!0},l.onMouseLeave=function(){this.definition.item.children.connectorGroup.visible=!1},l.onMouseDrag=function(e){this.position+=e.delta}}function makeConnectors(e,n,t,o){var i=new Path.Circle({radius:6,fillColor:"grey",type:"connector",name:"connector"}),c=[new Point(e+t/2,n),new Point(e,n+o/2),new Point(e-t/2,n),new Point(e,n-o/2)],r=new Group({name:"connectorGroup"}),l=new Symbol(i);return c.forEach(function(e,n){r.addChild(new SymbolItem(l,e))}),r}function addConnectorEvents(){function e(e,n){if("click"===e.type)if(console.log(r),r)s=n.bounds.center,i=c.clone(),r=!1;else{t=n.bounds.center;r=!0}else if("mousemove"===e.type){o=e.point-t,c&&c.remove();var l=o.normalize(10),s=t+o;c=new Group({children:[new Path([t,s]),new Path([s+l.rotate(135),s,s+l.rotate(-135)])],name:"connection"}),c.strokeColor="blue"}else"mouseup"===e.type&&console.log("yes")}var n=project.getItems({class:Group,name:"connectorGroup"});console.log(n),n.forEach(function(n){n.onClick=function(n){var t=this.hitTest(n.point);t&&e(n,t.item)}}),project.view.onMouseMove=function(n){n.stop(),e(n)};var t,o,i,c,r=!1}function drawEvent(e,n){var t=new Path.Circle({radius:25,center:[e,n],strokeWidth:2,strokeColor:"black",fillColor:"white",type:"event",name:"event",userName:"",subtype:""}),o=new Symbol(t),i=o.place([e,n]),c=new PointText({fontSize:16,fillColor:"black",justification:"center",name:"elementText",point:[e,n+50]}),r=makeConnectors(e,n,50,50);addConnectorEvents();var l=new Group({children:[i,c,r],name:"eventGroup"});l.firstChild.onClick=function(e){this.selected=!0},l.firstChild.onDoubleClick=function(e){this.selected=!1},l.firstChild.onMouseDrag=function(e){this.selected&&(this.parent.position+=e.delta)},l.onMouseEnter=function(){},l.onMouseLeave=function(){}}function insertProps(e){var n=document.querySelector(".props-menu"),t=n.querySelector(".prop-input"),o=n.querySelector(".prop-submit");n.classList.add("open"),t.focus(),o.addEventListener("click",function(){e.definition.item.children.elementText.content=t.value,t.value="",n.classList.remove("open")},{once:!0})}function getChildren(e,n){for(var t=[];e;e=e.nextSibling)1==e.nodeType&&e!=n&&t.push(e);return t}function getSiblings(e){return getChildren(e.parentNode.firstChild,e)}!function(){var e="";tool.minDistance=10,window.addEventListener("wheel",function(e){e.preventDefault(),e.deltaY>0?project.view.zoom-=.02:project.view.zoom+=.02}),document.querySelectorAll(".element-option").forEach(function(n){n.onclick=function(){e=this.getAttribute("data-type")}}),project.view.onMouseUp=function(n){""!==e&&("event"===e?(drawEvent(n.point.x,n.point.y),e=""):"activity"===e&&(drawActivity(n.point.x,n.point.y),e=""),insertProps(project.activeLayer.lastChild))}}(),function(){var e=document.querySelectorAll(".element");e.forEach(function(e){e.addEventListener("click",function(){this.classList.toggle("selected"),getSiblings(this).forEach(function(e){e.classList.remove("selected")})})}),document.querySelector("canvas").addEventListener("click",function(){e.forEach(function(e){e.classList.remove("selected")})})}();